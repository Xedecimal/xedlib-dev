<?php

require_once(__DIR__.'/../../../../lib/classes/data/DataSet.php');
require_once(__DIR__.'/../../../../h_main.php');

/**
 * Test class for DataSet.
 * Generated by PHPUnit on 2010-11-20 at 10:53:17.
 */
class DataSetTest extends PHPUnit_Framework_TestCase
{
	/**
	 * @var DataSet
	 */
	protected $object;

	/**
	 * Sets up the fixture, for example, opens a network connection.
	 * This method is called before a test is executed.
	 */
	public function testDataSet()
	{
		$sqlCreateTable = <<<EOF
CREATE TABLE `test` (
	`tst_id` INT UNSIGNED NOT NULL AUTO_INCREMENT,
	`tst_parent` INT UNSIGNED,
	`tst_name` VARCHAR(255),
	PRIMARY KEY (`tst_id`)
)
EOF;

		global $_d;

		# Locate database

		$url = parse_url($_d['settings']['database']);
		$url['path'] = '/temp';
		$target = http_build_url($url);

		$db = new Database();
		$db->Open($target, true);

		$this->object = new DataSet($db, 'test', 'tst_id');
		$dsChild = new DataSet($db, 'test', 'tst_id');

		$this->object->database->Query($sqlCreateTable);

		$this->object->AddChild(new Relation($dsChild, 'tst_parent', 'tst_id'));
		$this->object->AddJoin(new Join($dsChild, 'tst_parent = tst_id', 'LEFT JOIN'));

		# Creates

		$this->object->Add(array('tst_name' => 'test'));

		# Updates

		$this->object->Update(array('tst_name' => 'test'),
			array('tst_name' => 'test2'));

		# Gets

		$q['match']['tst_id'] = Database::SqlGreater(5);
		$q['match']['tst_parent'] = 0;
		$q['order']['tst_id'] = 'ASC';
		$q['limit'] = array('0, 10');
		$this->object->Get($q);

		# Cleanup

		$this->object->Remove(array('tst_name' => 'test'));
		$this->object->database->DropTable('test');
		$this->object->database->Drop();
	}
}

?>
